# Phase 1 Logs â€” Delta Map (vs DoD v0)

| DoD Section | Status | Evidence (path:lines) | Smallest delta |
| --- | --- | --- | --- |
| 1) Canonical event contract (scope keys + schema_version + severity) | PARTIAL | engines/dataset/events/schemas.py:9-32 (no project_id/app_id/run_id/step_id/severity/schema_version); engines/realtime/contracts.py:19-165 (routing + ids + meta.persist, missing project_id/app_id in routing defaults); engines/common/identity.py:22-151 (RequestContext requires tenant/env/project_id/surface/app) | Extend canonical schema to include all required fields and adopt everywhere; align StreamEvent/DatasetEvent; add schema_version + severity. |
| 2) Event types (story, pulse, tool/model, safety/HITL, cost, errors) | PARTIAL | engines/chat/pipeline.py:55-126 (chat message events only); engines/logging/audit.py:18-53 (audit action); engines/logging/event_log.py:35-75 (generic event log); engines/budget/routes.py:12-78 (usage events) | Define enum list + emit for required types; add state_pulse, flow_started/step, tool_call_*; wire safety/HITL placeholders; ensure cost events carry run_id/step_id. |
| 3) Storage & immutability split (ops vs audit, hash chaining) | MISSING | engines/nexus/backends/__init__.py:8-32 (firestore/bigquery only, no audit chain); engines/nexus/backends/firestore_backend.py:68-71 (plain add); engines/nexus/backends/bigquery_backend.py:26-35 (plain insert) | Introduce audit store with prev_hash/hash fields and append-only API; keep ops timeline store separate; fail fast if missing; add hash chaining. |
| 4) PII boundary & redaction | PARTIAL | engines/logging/events/engine.py:17-46 (PII mask + train_ok before persistence); engines/guardrails/pii_text/engine.py:1-43 (regex mask); engines/chat/service/llm_client.py:27-50 (sends raw prompt to Vertex, no redaction); engines/nexus/rag_service.py:38-96 (logs raw prompt text); engines/eval/service.py:73-87 (logs prompt text) | Apply redaction layer to tool/model calls and stored inputs/outputs; document optional encrypted payload hook; enforce single redaction entrypoint. |
| 5) Streaming + replay (durable) | PARTIAL | engines/chat/service/sse_transport.py:23-68 (SSE with Last-Event-ID, in-memory replay); engines/chat/service/ws_transport.py:136-205 (WS resume_cursor on in-memory bus); engines/realtime/contracts.py:74-165 (StreamEvent with event_id/meta.persist) | Back stream replay by durable store; selective streams; idempotent IDs; cursor resume from durable timeline. |
| 6) Retention / DSAR / Export | MISSING | NOT FOUND (no retention/export/delete policy; training prefs only: engines/privacy/train_prefs.py:117-140) | Add retention policy objects per tenant/app; export+delete commands/endpoints; audit deletions. |
| 7) Developer logs (structured + correlated) | MISSING | logging is per-event stdout in logging engine (engines/logging/events/engine.py:37-46); no standard structured Python logger with context | Introduce structured logger middleware including request_id/tenant/project; tie exceptions to event IDs. |
| 8) Acceptance gates | PARTIAL | No tests for DoD gates; only Phase 0 gates exist (docs/foundational/PHASE_0_*). | Define Phase 1 gate suite (event contract/context/PII/audit chain/streaming/usage/retention) with runnable commands. |
