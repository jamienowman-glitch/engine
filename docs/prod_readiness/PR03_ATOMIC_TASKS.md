## Hardening (identity/envelope/routing/durability)
- PR-HARD-01 (SECURITY) — Preconditions: `engines/chat/store_service.py` backend abstraction. Files: `engines/chat/service/sse_transport.py`, `engines/chat/service/ws_transport.py`. Acceptance: enforce `X-Mode/X-Project-Id/X-App-Id` via `assert_context_matches`; tests reject missing/override headers. Unblocks: compliant chat streaming.
- PR-HARD-02 (QUALITY) — Preconditions: durable chat_store backend available. Files: `engines/chat/service/transport_layer.py`, `engines/chat/store_service.py`. Acceptance: add durable replay store (no in-memory fallback) with restart/resume tests for SSE/WS. Unblocks: restart-safe streaming.
- PR-HARD-03 (SECURITY) — Preconditions: RequestContext builder. Files: `engines/canvas_stream/router.py`. Acceptance: enforce mode/project/app in `_canvas_context`; tests reject missing headers/ticket misuse. Unblocks: canvas streaming identity.
- PR-HARD-04 (QUALITY) — Preconditions: durable canvas event store chosen. Files: `engines/canvas_stream/router.py`, `engines/canvas_stream/service.py`. Acceptance: persist canvas events to durable store and replay with Last-Event-ID; tests simulate restart and cursor-invalid 410 envelope. Unblocks: canvas replay reliability.
- PR-HARD-05 (SECURITY) — Preconditions: RequestContext available. Files: `engines/canvas_artifacts/router.py`. Acceptance: require RequestContext/Auth (mode/tenant/project) and canonical error envelope; tests cover missing headers and tenant mismatch. Unblocks: safe canvas uploads.
- PR-HARD-06 (SECURITY) — Preconditions: error_envelope helper. Files: `engines/muscle/media_v2/routes.py`. Acceptance: wrap errors using canonical `ErrorEnvelope`; tests cover validation and auth failures. Unblocks: consistent media_v2 responses.
- PR-HARD-07 (SECURITY) — Preconditions: runtime config detection. Files: `engines/muscle/media_v2/service.py`. Acceptance: in saas/enterprise, fail fast if RAW_BUCKET/Firestore config absent (no LocalMediaStorage); tests assert RuntimeError when missing. Unblocks: sellable durability.
- PR-HARD-08 (SECURITY) — Preconditions: RequestContext enforcement. Files: `engines/muscle/audio_semantic_timeline/routes.py`. Acceptance: require RequestContext/Auth, enforce tenant/mode; tests reject missing headers/token. Unblocks: secure audio semantic API.
- PR-HARD-09 (SECURITY) — Preconditions: RequestContext available. Files: `engines/muscle/image_core/routes.py`. Acceptance: add RequestContext/Auth for render endpoints; tests ensure 401/403 on missing/mismatch. Unblocks: image render safety.
- PR-HARD-10 (SECURITY) — Preconditions: RequestContext for standalone apps. Files: `engines/scene_engine/service/routes.py`, `server.py`. Acceptance: enforce mode/tenant/project on `/scene/build`; tests reject missing headers. Unblocks: safe scene_engine exposure.
- PR-HARD-11 (SECURITY) — Preconditions: RequestContext available. Files: `engines/marketing_cadence/routes.py`. Acceptance: add RequestContext/Auth with mode/tenant/project enforcement; tests cover missing headers and tenant mismatch. Unblocks: secure marketing cadence.
- PR-HARD-12 (SECURITY) — Preconditions: gate_chain available. Files: `engines/muscle/cad_ingest/routes.py`, `engines/chat/service/server.py`. Acceptance: mount cad_ingest behind feature flag and integrate gate_chain/budget/audit; tests prove availability and canonical errors. Unblocks: cad ingest exposure.
- PR-HARD-13 (QUALITY) — Preconditions: Firestore config detection. Files: `engines/muscle/video_timeline/service.py`. Acceptance: fail fast when Firestore config missing (no silent fallback); tests simulate missing env -> raises. Unblocks: predictable timeline behavior.
- PR-HARD-14 (QUALITY) — Preconditions: error_envelope helper. Files: `engines/nexus/vector_explorer/routes.py`, `engines/nexus/vector_explorer/ingest_routes.py`. Acceptance: wrap errors in ErrorEnvelope and enforce RequestContext (mode/project) for query + ingest; tests cover missing headers/unauthorized ingest. Unblocks: consistent vector explorer responses.
- PR-HARD-15 (QUALITY) — Preconditions: error_envelope helper. Files: `engines/nexus/raw_storage/routes.py`. Acceptance: use canonical ErrorEnvelope for failures; ensure put/get enforce tenant/mode; tests cover ForbiddenBackendClass and missing headers. Unblocks: raw storage safety.

## Artifact correctness (media_v2 + pipeline_hash + meta)
- PR-ART-01 (QUALITY) — Files: `engines/muscle/media_v2/models.py`, `engines/muscle/media_v2/service.py`. Acceptance: include deterministic pipeline_hash/backend_version in artifact meta for creations; tests assert fields present. Unblocks: artifact traceability.
- PR-ART-02 (QUALITY) — Files: `engines/muscle/audio_service/service.py`. Acceptance: ensure outputs (audio_clean/segment/beat/asr/bars/voice_enhance) include backend_version/pipeline_hash meta; tests assert meta presence. Unblocks: audio artifact traceability.
- PR-ART-03 (QUALITY) — Files: `engines/muscle/video_render/service.py`. Acceptance: add pipeline_hash for render plans to artifact meta; tests validate stability. Unblocks: render artifact determinism.
- PR-ART-04 (QUALITY) — Files: `engines/muscle/video_regions/service.py`. Acceptance: ensure video_region_summary artifacts include backend_version/cache_key/pipeline_hash; tests assert meta fields. Unblocks: region artifact reliability.
- PR-ART-05 (QUALITY) — Files: `engines/image_core/service.py`. Acceptance: media_v2 artifacts for image renders/compositions include pipeline_hash/backend_version; tests assert meta. Unblocks: image artifact determinism.
- PR-ART-06 (QUALITY) — Files: `engines/muscle/audio_semantic_timeline/service.py`. Acceptance: semantic artifacts include backend_version/pipeline_hash meta; tests assert fields. Unblocks: semantic traceability.

## Observability (budget/audit/gates)
- PR-OBS-01 (QUALITY) — Files: `engines/muscle/audio_service/service.py`. Acceptance: emit BudgetService usage + audit/event_spine for mutating ops; tests assert budget calls with request_id/run_id.
- PR-OBS-02 (SECURITY) — Files: `engines/muscle/video_render/routes.py`, `engines/muscle/video_render/service.py`. Acceptance: emit budget/audit on render/job submissions with surface/project metadata; tests assert BudgetService invoked and errors envelope-wrapped on budget block.
- PR-OBS-03 (SECURITY) — Files: `engines/muscle/cad_ingest/routes.py`, `engines/muscle/cad_ingest/service.py`. Acceptance: budget/audit emissions on ingest; tests assert gate_chain/budget called and errors envelope-wrapped.
- PR-OBS-04 (QUALITY) — Files: `engines/budget/repository.py`, `engines/budget/routes.py`. Acceptance: add durable backend option (Firestore/S3) and wrap all validation errors in ErrorEnvelope; tests cover durable read/write and missing mode/project errors. Unblocks: cost logging reliability.
- PR-OBS-05 (QUALITY) — Files: `engines/nexus/vector_explorer/ingest_routes.py`. Acceptance: add budget/audit/gatechain (if required) or explicitly document NA with tests; ensure ErrorEnvelope on violations. Unblocks: safe ingest.
- PR-OBS-06 (QUALITY) — Files: `engines/marketing_cadence/service.py`. Acceptance: optional audit/budget hooks or documented NA; tests ensure no PII logging and deterministic schedule IDs. Unblocks: compliance for cadence.

## Streaming correctness
- PR-STREAM-01 (QUALITY) — Files: `engines/chat/service/sse_transport.py`, `engines/chat/service/transport_layer.py`. Acceptance: invalid cursor returns 410 ErrorEnvelope; restart resume verified in tests. Unblocks: chat streaming reliability.
- PR-STREAM-02 (QUALITY) — Files: `engines/canvas_stream/router.py`. Acceptance: cursor validation returns 410 ErrorEnvelope; restart resume verified. Unblocks: canvas streaming reliability.
